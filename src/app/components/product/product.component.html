<!-- ================ start banner area ================= -->
<section class="blog-banner-area" id="category">
  <div class="container h-100">
    <div class="blog-banner">
      <div class="text-center">
        <h1>Products</h1>
        <nav aria-label="breadcrumb" class="banner-breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Products</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</section>
<!-- ================ end banner area ================= -->

<!-- ================ category section start ================= -->
<section class="section-margin--small mb-5">
  <div class="container">
    <div class="row">
      <div class="col-xl-3 col-lg-4 col-md-5">
        <!-- Category Section -->
        <div class="sidebar-categories">
          <div class="head">Browse Categories</div>
          <ul class="main-categories">
            <li class="common-filter">
              <ul>
                <li class="filter-list">
                  <input class="pixel-radio" 
                         type="radio" 
                         id="all" 
                         name="gender" 
                         value="all" 
                         [checked]="selectedGender === 'all'"
                         (change)="onGenderChange('all')">
                  <label for="all" [class.active]="selectedGender === 'all'">All</label>
                </li>
                <li class="filter-list">
                  <input class="pixel-radio" 
                         type="radio" 
                         id="men" 
                         name="gender" 
                         value="MALE" 
                         [checked]="selectedGender === 'MALE'"
                         (change)="onGenderChange('MALE')">
                  <label for="men" [class.active]="selectedGender === 'MALE'">Men</label>
                </li>
                <li class="filter-list">
                  <input class="pixel-radio" 
                         type="radio" 
                         id="women" 
                         name="gender" 
                         value="FEMALE" 
                         [checked]="selectedGender === 'FEMALE'"
                         (change)="onGenderChange('FEMALE')">
                  <label for="women" [class.active]="selectedGender === 'FEMALE'">Women</label>
                </li>
                <li class="filter-list">
                  <input class="pixel-radio" 
                         type="radio" 
                         id="unisex" 
                         name="gender" 
                         value="UNISEX" 
                         [checked]="selectedGender === 'UNISEX'"
                         (change)="onGenderChange('UNISEX')">
                  <label for="unisex" [class.active]="selectedGender === 'UNISEX'">Unisex</label>
                </li>
              </ul>
              <!-- Filter By Price -->
              <div class="head">Price</div>
              <div class="common-filter">
                <div class="price-range-area">
                  <div class="price-slider-wrapper" style="position: relative; z-index: 1;">
                    <ngx-slider 
                      [(value)]="filters.minPrice" 
                      [(highValue)]="filters.maxPrice" 
                      [options]="sliderOptions" 
                      (userChangeEnd)="applyFilters()"
                      style="pointer-events: auto;">
                    </ngx-slider>
                  </div>
                  <div class="value-wrapper d-flex">
                    <div class="price">Price:</div>
                    <div>{{ filters.minPrice | number:'1.0-2' }}</div>
                    <span>EGP</span>
                    <div class="to">to</div>
                    <div>{{ filters.maxPrice | number:'1.0-2' }}</div>
                    <span>EGP</span>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-xl-9 col-lg-8 col-md-7">
        <!-- Start Filter Bar -->
        <div class="filter-bar d-flex flex-wrap align-items-center">
          <div>
            <div class="input-group filter-bar-search" style="min-width: 335px;">
              <input type="text" placeholder="Search" [(ngModel)]="filters.searchQuery" (ngModelChange)="onSearchChange()" style="width: 88%;">
              <div class="input-group-append">
                <button type="button" (click)="applyFilters()">
                  <i class="ti-search"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- End Filter Bar -->
        <!-- Start Best Seller -->
        <section class="lattest-product-area pb-40 category-list">
          <div class="row" *ngIf="products.length > 0; else noResults">
            <div class="col-lg-4 col-md-6 col-sm-6 mb-4" *ngFor="let perfume of products">
              <div class="card text-center card-product h-100">
                <a [routerLink]="['/product-details']" [queryParams]="{ id: perfume.id, name: perfume.name }" style="text-decoration: none; color: inherit;">
                  <div class="card-product__img position-relative">
                    <span *ngIf="perfume.quantity === 0" class="badge position-absolute top-0 end-0 m-2" style="font-size: 0.8rem; background-color: #384AEB; border: 1px solid white; color: white; padding: 5px 10px; font-weight: bold;">
                      SOLD OUT
                    </span>
                    <img class="card-img" [src]="perfume.imageUrl" [alt]="perfume.name">
                    <ul class="card-product__imgOverlay" *ngIf="perfume.quantity > 0">
                      <li>
                        <a [routerLink]="['/product-details']" [queryParams]="{ id: perfume.id, name: perfume.name }">
                          <i class="ti-eye"></i>
                        </a>
                      </li>
                      <li>
                        <button type="button" style="color: white;" (click)="addToCart($event, perfume)">
                          <i class="ti-shopping-cart" style="margin-right: 5px;"></i>Add to cart
                        </button>
                      </li>
                    </ul>
                  </div>
                  <div class="card-body d-flex flex-column justify-content-between">
                    <div>
                      <p class="mb-2">{{ perfume.brand }}</p>
                      <h4 class="card-product__title">{{ perfume.name }}</h4>
                    </div>
                    <p class="card-product__price mt-auto">{{ perfume.price | currency:'EGP':'symbol':'1.0-2' }}</p>
                  </div>
                </a>
              </div>
            </div>
          </div>
          <ng-template #noResults>
            <div class="col-12 text-center py-5">
              <div class="no-results-container">
                <i class="bi bi-search fa-3x text-muted mb-4"></i>
                <h3 class="mb-3">No Results Found</h3>
                <p class="text-muted">We couldn't find any items matching your search<br>Try adjusting your filters or search terms</p>
              </div>
            </div>
          </ng-template>
          
          <!-- Pagination -->
          <div class="row" *ngIf="totalPages > 1">
            <div class="col-12">
              <nav aria-label="Product pagination">
                <div class="pagination justify-content-center">
                  <a *ngIf="currentPage > 1" 
                     [routerLink]="['/products']" 
                     [queryParams]="getPageParams(currentPage - 1)" 
                     class="btn btn-sm btn-outline-primary mx-1">
                    Previous
                  </a>
                  <a *ngFor="let page of getPageRange()" 
                     [routerLink]="['/products']" 
                     [queryParams]="getPageParams(page)" 
                     class="btn btn-sm mx-1" 
                     [ngClass]="{'btn-primary active': page === currentPage, 'btn-outline-primary': page !== currentPage}">
                    {{ page }}
                  </a>
                  <a *ngIf="currentPage < totalPages" 
                     [routerLink]="['/products']" 
                     [queryParams]="getPageParams(currentPage + 1)" 
                     class="btn btn-sm btn-outline-primary mx-1">
                    Next
                  </a>
                </div>
              </nav>
            </div>
          </div>
        </section>
        <!-- End Best Seller -->
      </div>
    </div>
  </div>
</section>
<!-- ================ end category section  ================= -->

<!-- Toast Notifications -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 9999">
  <!-- Regular Toast -->
  <div #toastElement id="regularToast" class="toast align-items-center" 
       [ngClass]="{'text-bg-success': toastSuccess, 'text-bg-danger': !toastSuccess}" 
       role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">{{ toastMessage }}</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
  
  <!-- Login Required Toast -->
  <div #loginToastElement id="loginToast" class="toast align-items-center text-bg-danger border-0" 
       role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        You must log in to add items to the cart.
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>